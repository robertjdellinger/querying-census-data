"0",""
"0","# California only"
"0","fips.ca <- ""CA"""
"0",""
"0","# Run with same structure (for consistency with national code)"
"0","ca_bg_sf <- reduce("
"0","  future_map(fips.ca, function(x) {"
"0","    get_acs("
"0","      geography = ""block group"", "
"0","      variables = c("
"0","        ""pop""         = ""B03002_001"",  # Total population"
"0","        ""pop_nhwhite"" = ""B03002_003"",  # Non-Hispanic White"
"0","        ""pop_nhblack"" = ""B03002_004"",  # Non-Hispanic Black"
"0","        ""popx_nhamind""= ""B03002_005"",  # Non-Hispanic American Indian"
"0","        ""popx_nhasian""= ""B03002_006"",  # Non-Hispanic Asian"
"0","        ""popx_nhhwnpi""= ""B03002_007"",  # Non-Hispanic Hawaiian/PI"
"0","        ""popx_nhother""= ""B03002_008"",  # Non-Hispanic Other"
"0","        ""popx_nhtwomr""= ""B03002_009"",  # Non-Hispanic Two+"
"0","        ""pop_hispltx"" = ""B03002_012"",  # Hispanic/Latinx"
"0","        ""hu_total""    = ""B25001_001"",  # Total housing units"
"0","        ""hu_totocc""   = ""B25003_001"",  # Occupied housing units"
"0","        ""hu_totown""   = ""B25003_002"",  # Owner-occupied"
"0","        ""hu_totrnt""   = ""B25003_003"",  # Renter-occupied"
"0","        ""hh_total""    = ""B19001_001"",  # Total households"
"0","        ""hh_medinc""   = ""B19013_001""   # Median household income"
"0","      ), "
"0","      year = 2019,"
"0","      survey = ""acs5"","
"0","      state = x,"
"0","      geometry = TRUE,"
"0","      output = ""wide"","
"0","      keep_geo_vars = TRUE"
"0","    )"
"0","  }, .progress = TRUE),"
"0","  rbind"
"0",")"
"2","Getting data from the 2015-2019 5-year ACS
"
"2","Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.
"
"2","Using FIPS code '06' for state 'CA'
"
"0","# Plot map"
"0","ggplot(data = ca_bg_sf) +"
"0","  geom_sf(aes(fill = hh_medincE), color = NA) +"
"0","  viridis::scale_fill_viridis("
"0","    name = ""Median Income ($)"","
"0","    option = ""plasma"","
"0","    trans = ""log"",  # Useful for skewed income data"
"0","    na.value = ""grey90"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  labs("
"0","    title = ""Median Household Income by Block Group (California, ACS 2019)"","
"0","    caption = ""Source: U.S. Census Bureau, 2019 ACS 5-Year Estimates"""
"0","  )"
